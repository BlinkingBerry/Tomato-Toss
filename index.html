<!DOCTYPE html>
<html lang="en-us">
  <head>
    <body>

    <title>Tomato Toss</title>

    <style>
        canvas{background: #eee; display: block; margin: 0 auto; }
    </style>

    <canvas id="tomatoCanvas" width="855" height="480"></canvas>

    <script src="https://code.createjs.com/1.0.0/createjs.min.js"></script>

    <script>

    var canvas = document.getElementById("tomatoCanvas");
    var ctx = canvas.getContext("2d");

    var tomatoX = canvas.width/2;
    var tomatoY = canvas.height-100;
    var tomatoDX = 1.5;
    var tomatoDY = -2;
    var tomatoRadius = 10;

    class Tomato{
        constructor(x, y, dx, dy, momentum){
            this.tomatox = x;
            this.tomatoy = y;
            this.tomatodx = dx;
            this.tomatody = dy;
            this.tomatomomentum = momentum;
		}
	}

    var momentumY = 100;

    var critterHeight = 75;
    var critterWidth = 50;
    var critterX = canvas.width/2-critterWidth/2;
    var critterY = canvas.height-critterHeight;
    var critterCanMove = true;

    leftPressed = false;
    rightPressed = false;

    var score = 0;

    function draw(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawTomato();
        bounceTomatoOffWalls();
        drawCritter();
        drawScore();
        requestAnimationFrame(draw);
	}

    function drawTomato(){

     let tomatoes = [{x:canvas.width/2,y:canvas.height-100,xv:1.5,yv:-2, momentum:100},{x:canvas.width/2,y:canvas.height-150,xv:1.5,yv:-2, momentum:100}];
     for (let t of tomatoes) {
            tomatoes.x += tomatoes.xv;
            tomatoes.y += tomatoes.yv*(tomatoes.momentum/50);
            tomatoes.momentum--;

            ctx.beginPath();
            ctx.arc(tomatoes.x, tomatoes.y, tomatoRadius, 0, Math.PI*2);
            ctx.fillStyle = "#fc0339";
            ctx.fill();
            ctx.closePath();
     }

     /*

     ctx.beginPath();
     ctx.arc(tomatoX, tomatoY, tomatoRadius, 0, Math.PI*2);
     ctx.fillStyle = "#fc0339";
     ctx.fill();
     ctx.closePath();

     tomatoX += tomatoDX;
     tomatoY += tomatoDY*(momentumY/50);
     momentumY--;

     */
	}

    function bounceTomatoOffWalls(){
        if(tomatoX > canvas.width-tomatoRadius){
            tomatoDX = -tomatoDX;
		}
        if(tomatoX < 0+tomatoRadius){
            tomatoDX = -tomatoDX;
		}
        if(tomatoY > canvas.height-tomatoRadius-critterHeight){
            if(tomatoX < critterX+critterWidth && tomatoX > critterX){
                momentumY = Math.random()*75+50;  
                score += 10;
            }
            else{
                if(tomatoX < critterX && tomatoX > critterX-tomatoRadius){
                    tomatoDX = -tomatoDX; 
                    tomatoX = tomatoX-1;
                    critterCanMove = false;
				}     
                else{
                    if(tomatoX < critterX+critterWidth+tomatoRadius && tomatoX > critterX+critterWidth)        {
                        tomatoDX = -tomatoDX;
                        tomatoX = tomatoX+1;
                        critterCanMove = false;
					}
				}
			}
		}
        if(tomatoY > canvas.height-tomatoRadius){
              document.location.reload();
              alert("Game Over");
		}
	}

    function drawCritter(){

     ctx.beginPath();
     ctx.rect(critterX, critterY, critterWidth, critterHeight);
     ctx.fillStyle = "#ff9d52";
     ctx.fill();
     ctx.closePath();

     if(rightPressed == true){
        if(critterX < canvas.width-critterWidth){
            if(critterCanMove == true){
                critterX += 7;
            }
        }
	 }
     if(leftPressed == true){
        if(critterX > 0){
            if(critterCanMove == true){
                critterX -= 7;
            }
        }
	 }
	}

    function drawScore(){
        ctx.font = "16px Arial";
        ctx.fillStyle = "#fc0339";
        ctx.fillText("Score: " + score, 8, 20);
	}

    document.addEventListener("keydown", keyDownHandler, false);
    document.addEventListener("keyup", keyUpHandler, false);
    document.addEventListener("mousemove", mouseMoveHandler, false);

    function keyDownHandler(e){
     if(e.key == "Right" || e.key == "ArrowRight"){
      rightPressed = true;
     }
     else if(e.key == "Left" || e.key == "ArrowLeft"){
      leftPressed = true;
	 }
	}

    function keyUpHandler(e){
     if(e.key == "Right" || e.key == "ArrowRight"){
      rightPressed = false;
	 }
     else if(e.key == "Left" || e.key == "ArrowLeft"){
      leftPressed = false;
	 }
	}

    function mouseMoveHandler(e){
        var relativeX = e.clientX - canvas.offsetLeft;
        if(relativeX > 0+critterWidth/2 && relativeX < canvas.width-critterWidth/2){

            if(critterCanMove == true){
                critterX = relativeX-critterWidth/2;
            }
       
		}
        else{
            if(relativeX < canvas.width/2){
                if(critterCanMove == true){
                    critterX = 0;
                }
			}
            if(relativeX > canvas.width/2){
                if(critterCanMove == true){
                    critterX = canvas.width-critterWidth;  
				}     
			}
		}
	}

    createjs.Sound.registerSound("bounce.WAV", "bounce");

    function bounceSoundActivate(){
        var bounceSound = createjs.Sound.play("bounce");
        bounceSound.volume = 0.5;
	}

    bounceSoundActivate();

    draw();

    </script>


	</body>
  </head>
</html>
